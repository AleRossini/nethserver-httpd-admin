#!/usr/bin/perl -w

use esmith::Build::CreateLinks  qw(:all);

my $event;

# Symlink httpd-admin to httpd.
safe_symlink("httpd", "root/usr/sbin/httpd-admin");

# conf-httpd-admin
templates2events("/etc/httpd/admin-conf/httpd.conf", (qw(
    nethserver-httpd-admin-update
    console-save
    bootstrap-console-save
    network-create
    network-delete
    remoteaccess-update
    logrotate
)));

templates2events("/etc/sudoers", (qw(
    nethserver-httpd-admin-update
)));

# Set up generic logfile timestamp renaming/symlinking
foreach (qw(
    /var/log/httpd/admin_access_log
    /var/log/httpd/admin_error_log
)) {
    safe_touch "root/etc/e-smith/events/logrotate/logfiles2timestamp" . $_;
    safe_touch "root/etc/e-smith/events/post-install/logfiles2timestamp" . $_;
    safe_touch "root/etc/e-smith/events/post-upgrade/logfiles2timestamp" . $_;
}

safe_symlink("reload", "root/etc/e-smith/events/$_/services2adjust/httpd-admin") foreach(qw(
  console-save 
  remoteaccess-update 
  logrotate
));


# Adds http-admin key in configuration database:
$event = 'nethserver-httpd-admin-update';
event_link("initialize-default-databases", $event, "05");
event_link("runlevel-adjust", $event, "50");
event_link("firewall-adjust", $event, "55");
event_link("nethserver-httpd-admin-conf", $event, "60");
safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/httpd-admin");
